<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <div th:include="include::header"></div>
    <style>
        h1 {
            margin-top: 200px;
            color: #5FB878;
        }

        .layui-card-body {
            text-align: center;
        }

        /*    隐藏表格工具栏元素、表头元素*/
        .layui-table-tool, .layui-table-header {
            display: none;
        }

    </style>
</head>
<body class="pear-container">
<!--内容-->
<div class="layui-card">
    <div class="layui-card-body">
        <div class="layui-tab layui-tab-brief">
            <ul class="layui-tab-title">
                <li class="layui-this">我的日志</li>
                <li>私密日志</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show">
                    <div class="layui-row layui-col-space10">
                        <!--我的日志左边部分-->
                        <div class="layui-col-sm10">
                            <!--左边部分第一行-->
                            <div class="layui-row">
                                <div class="layui-col-sm12">
                                    <button type="button" class="layui-btn">写日志</button>
                                </div>
                            </div>
                            <!--左边部分第二行-->
                            <div class="layui-row">
                                <div class="layui-col-sm12">
                                    <table id="user-table" lay-filter="user-table"></table>
                                </div>
                            </div>
                        </div>
                        <!--我的日志右边部分-->
                        <div class="layui-col-sm2">
                            <div class="layui-bg-gray" style="padding: 10px;">
                                <!--右边部分第一行-->
                                <div class="layui-row layui-col-space15">
                                    <div class="layui-col-md12">
                                        <div class="layui-card">
                                            <div class="layui-card-header">日志分类</div>
                                            <div class="layui-card-body">
                                                <ul style="text-align: left">
                                                    <li>日志1</li>
                                                    <li>日志2</li>
                                                    <li>日志3</li>
                                                    <li>日志4</li>
                                                    <li>日志5</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--右边部分第二行-->
                                <div class="layui-row layui-col-space15">
                                    <div class="layui-col-md12">
                                        <div class="layui-card">
                                            <div class="layui-card-header">搜索日志</div>
                                            <div class="layui-card-body">
                                                <input type="text" name="title" autocomplete="off" placeholder="请输入关键字" class="layui-input">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--右边部分第三行-->
                                <div class="layui-row layui-col-space15">
                                    <div class="layui-col-md12">
                                        <div class="layui-card">
                                            <div class="layui-card-header">评论审核</div>
                                            <div class="layui-card-body">
                                                56456
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-tab-item">
                    内容02
                </div>
            </div>
        </div>
    </div>
</div>
<div th:include="include::footer"></div>
<!--表格-->
<script type="text/html" id="oper">
    <div class="layui-btn-group">
        <button type="button" class="layui-btn layui-btn-primary layui-btn-xs">
            <i class="layui-icon">&#xe642;</i>编辑
        </button>
        <button type="button" class="layui-btn layui-btn-primary layui-btn-xs">
            <i class="layui-icon">&#xe640;</i>删除
        </button>
    </div>
</script>
<script>
    layui.use(['table', 'form', 'jquery'], function () {
        let table = layui.table;
        let form = layui.form;
        let $ = layui.jquery;

        let MODULE_PATH = "/system/user/";

        let cols = [
            [
                // {
                //     type: 'checkbox'
                // },
                {
                    field: 'titleName',
                    align: 'left',
                    // width: 900
                },
                {
                    field: 'createTime',
                    align: 'right',
                    templet: '#user-createTime'
                },
                {
                    align: 'right',
                    templet: '#oper'
                }
            ]
        ];

        table.render({
            elem: '#user-table',
            url: '../../journal/data/table.json',
            page: true,
            cols: cols,
            skin: 'line',
            toolbar: '#user-toolbar',
            defaultToolbar: [],
            even: true,
        });

        table.on('tool(user-table)', function (obj) {
            if (obj.event === 'remove') {
                window.remove(obj);
            } else if (obj.event === 'edit') {
                window.edit(obj);
            }
        });

        table.on('toolbar(user-table)', function (obj) {
            if (obj.event === 'add') {
                window.add();
            } else if (obj.event === 'refresh') {
                window.refresh();
            } else if (obj.event === 'batchRemove') {
                window.batchRemove(obj);
            }
        });

        form.on('submit(user-query)', function (data) {
            table.reload('user-table', {
                where: data.field
            })
            return false;
        });

        form.on('switch(user-enable)', function (obj) {
            layer.tips(this.value + ' ' + this.name + '：' + obj.elem.checked, obj.othis);
        });

        window.add = function () {
            layer.msg("新增");
        }

        window.edit = function (obj) {
            layer.msg("修改");
        }

        window.remove = function (obj) {
            layer.confirm('确定要删除该用户', {
                icon: 3,
                title: '提示'
            }, function (index) {
                layer.close(index);
                let loading = layer.load();
                $.ajax({
                    url: MODULE_PATH + "remove/" + obj.data['userId'],
                    dataType: 'json',
                    type: 'delete',
                    success: function (result) {
                        layer.close(loading);
                        if (result.success) {
                            layer.msg(result.msg, {
                                icon: 1,
                                time: 1000
                            }, function () {
                                obj.del();
                            });
                        } else {
                            layer.msg(result.msg, {
                                icon: 2,
                                time: 1000
                            });
                        }
                    }
                })
            });
        }

        window.batchRemove = function (obj) {
            let data = table.checkStatus(obj.config.id).data;
            if (data.length === 0) {
                layer.msg("未选中数据", {
                    icon: 3,
                    time: 1000
                });
                return false;
            }
            let ids = "";
            for (let i = 0; i < data.length; i++) {
                ids += data[i].userId + ",";
            }
            ids = ids.substr(0, ids.length - 1);
            layer.confirm('确定要删除这些用户', {
                icon: 3,
                title: '提示'
            }, function (index) {
                layer.close(index);
                let loading = layer.load();
                $.ajax({
                    url: MODULE_PATH + "batchRemove/" + ids,
                    dataType: 'json',
                    type: 'delete',
                    success: function (result) {
                        layer.close(loading);
                        if (result.success) {
                            layer.msg(result.msg, {
                                icon: 1,
                                time: 1000
                            }, function () {
                                table.reload('user-table');
                            });
                        } else {
                            layer.msg(result.msg, {
                                icon: 2,
                                time: 1000
                            });
                        }
                    }
                })
            });
        }

        window.refresh = function (param) {
            table.reload('user-table');
        }
    })
</script>
</body>
</html>